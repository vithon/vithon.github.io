<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>  Lập trình giao diện trong Python
 | Python Cho Người Việt</title>

    <meta name="author" content="Nhóm PCNV"/>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css"/>
    <link rel="stylesheet" href="../../theme/css/jquery.mglass.css"/>
    <link rel="stylesheet" href="../../theme/css/pygment-solarized-dark.css"/>
    <link rel="stylesheet" href="../../theme/css/style.css"/>

    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Istok+Web' rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Droid+Sans+Mono' rel='stylesheet' type='text/css'/>


    <link rel="icon" href="../../favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon">

    <!-- Feeds -->
      <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Python Cho Người Việt - All posts - Atom Feed"/>
      <link href="/feeds/bai-viet.atom.xml" type="application/atom+xml" rel="alternate" title="Python Cho Người Việt - Category: Bài viết - Atom Feed"/>


  </head>

  <body>

    <div class="container">

      <div class="page-header">
          <a href="../.." class="container pull-left">
            <div class="">
              <div class="side"><img src="../../logo.png" class="img-responsive"/></div>
            </div>
          </a>
        <h1><a href="../..">Python Cho Người Việt</a> <small></small></h1>
      </div>

      <nav class="navbar navbar-default">

        <!-- Hamburger menu for mobile -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#plumage-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../.." title="">Python Cho Người Việt</a>
        </div>

        <!-- Menus and search forms -->
        <div class="collapse navbar-collapse" id="plumage-navbar-collapse-1">

          <ul class="nav navbar-nav">
<li >
                <a href="../../static/tutorial/2.5/tut.html">Bài chỉ dẫn 2.5</a>
              </li>
<li >
                <a href="../../category/tin-tuc.html">Tin tức</a>
              </li>
<li >
                <a href="../../category/bai-viet.html">Bài viết</a>
              </li>
<li >
                <a href="http://forum.vithon.org">Diễn đàn</a>
              </li>
<li >
                  <a href="../../page/about.html">Giới thiệu</a>
                </li>
          </ul>


            <form class="navbar-form navbar-right" role="search" action="../../search.html" onsubmit="return validateForm(this.elements['q'].value);">
              <div class="form-group">
                <div class="input-group">
                  <input type="text" name="q" id="tipue_search_input" class="form-control search-query" placeholder="Search" required />
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fa
                        fa-search fa-fw"></i></button>
                  </span>
                </div>
              </div>
            </form>

        </div>

      </nav>

    </div>


    <div class="container main">


      <div class="row">
        <div class=" col-md-9  ">
  <h1>
    <a href="../../2012/07/lap-trinh-giao-dien-trong-python.html" rel="bookmark" title="Permalink to Lập trình giao diện trong Python">Lập trình giao diện trong Python</a>
  </h1>
        </div>
      </div>

      <div class="row">


        <div class=" col-md-9 " id="content" role="main">
  

  <div>
    <p>Bài viết này bàn về hướng lập trình giao diện (programming to the interface) thay vì giao diện người dùng, hay giao diện đồ họa (user interface, graphical interface).</p>
<div class="section" id="lap-trinh-giao-dien">
<h2>Lập trình giao diện</h2>
<p>Lập trình giao diện (giao tiếp) là một trong hai nguyên tắc cơ bản được nhắc đến trong quyển sách kinh điển <strong>Design Patterns</strong>. Lập trình giao diện đặt trọng tâm vào việc tạo ra một hợp đồng (contract) chắc chắn giữa hai bên người dùng (consumer) và người cung cấp (producer):</p>
<dl class="docutils">
<dt>Người dùng</dt>
<dd>là bên sử dụng các lớp, hàm, hoặc mã mà người cung cấp tạo ra</dd>
<dt>Người cung cấp</dt>
<dd>là bên tạo ra thư viện mã</dd>
<dt>Hợp đồng</dt>
<dd>là các kiến thức chung mà cả người dùng và người cung cấp đều hiểu và tuân theo</dd>
</dl>
<p>Hợp đồng xác định các lớp cơ bản, và các phương thức của các lớp đó. Vì đây là hợp đồng được cả hai bên tuân theo nên ý nghĩa của các lớp, cũng như cách hoạt động của các phương thức phải được định nghĩa một cách tường minh và chuẩn xác. Người dùng sẽ dựa theo hợp đồng này và sử dụng các lớp trong đó cho mục đích riêng của họ, trong khi người cung cấp có thể thay đổi cách hiện thực hợp đồng một cách khả chuyển miễn sao vẫn đảm bảo được yêu cầu của hợp đồng.</p>
<p>Ví dụ: hợp đồng nêu ra là hàm <strong>func</strong> nhận vào một số nguyên, và trả về tổng của số nguyên đó với 2. Hợp đồng này rõ ràng ví nó xác định tên hàm (<strong>func</strong>), giá trị đầu vào (<strong>một số nguyên</strong>) và giá trị đầu ra (<strong>tổng của số nguyên nhập vào với 2</strong>). Người sử dụng, khi cần tính tổng của 5 và 2, có thể gọi <strong>func(5)</strong>. Người cung cấp có thể cài đặt <strong>def func(i): return i + 2</strong> hoặc <strong>func = lambda i: i + 2</strong> hoặc một cách nào khác miễn sao phù hợp với câu chữ của hợp đồng.</p>
<p>Theo quan điểm này, người sử dụng và người cung cấp giao tiếp với nhau thông qua một môi trường chung, một giao diện chung. Người sử dụng dựa trên giao diện này để yêu cầu dịch vụ từ người cung cấp. Còn người cung cấp dựa trên giao diện này để đáp ứng đúng yêu cầu người sử dụng.</p>
<p>Đối với các ngôn ngữ lập trình hướng đối tượng, chúng ta hay gặp các thuật ngữ như giao diện (<strong>interface</strong>), lớp trừu tượng (<strong>abstract class</strong>) và lớp cụ thể (<strong>concrete class</strong>). Giao diện mang tính chất của một hợp đồng, hoàn toàn không có bất kỳ một hiện thực cụ thể nào. Lớp cụ thể là một hiện thực đầy đủ của một giao diện. Và lớp trừu tượng là một hiện thực chưa đầy đủ của một giao diện.</p>
</div>
<div class="section" id="id1">
<h2>Lập trình giao diện trong Python</h2>
<p>Python không có sự phân biệt giữa ba khái niệm này. Tuy nhiên, trong thực tế, chúng ta hay viết mã tương tự như sau để mô phỏng một giao diện.</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Interface</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">method_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>
<p>Các phương thức trong lớp <strong>Interface</strong> chỉ có một câu lệnh duy nhất là <strong>raise NotImplementedError()</strong> để cố tình gây ra biệt lệ khi chúng được gọi.</p>
<p>Một lớp trừu tượng có thể được mô phỏng như sau:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AbstractClass</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># làm một việc gì đó</span>
        <span class="k">pass</span>
</pre></div>
<p>Lớp <strong>AbstractClass</strong> là lớp con của <strong>Interface</strong> và hiện thực hóa phương thức <strong>method_1</strong> nhưng vẫn để phương thức <strong>method_2</strong> lơ lửng.</p>
<p>Cuối cùng, một lớp cụ thể là một lớp con của <strong>Interface</strong> hoặc <strong>AbstractClass</strong> nhưng hiện thực hóa tất cả các phương thức.</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ConcreteClass</span><span class="p">(</span><span class="n">AbstractClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># làm một việc gì đó</span>
        <span class="k">pass</span>
</pre></div>
<p>Điểm đáng lưu ý là tất cả các lớp này đều hợp lệ trong Python. Chúng ta hoàn toàn có thể khởi tạo một đối tượng của một trong ba lớp này và chỉ đến khi gọi một hàm nào đó thì biệt lệ mới xảy ra. Nói cách khác, biệt lệ <strong>NotImplementedError</strong> chỉ được phát hiện khi chạy, trong khi đáng lẽ nó đã phải được phát hiện ngay khi dịch. Điều này làm mất giá trị của một hợp đồng, và hạn chế việc áp dụng hướng lập trình giao diện trong Python.</p>
<p>Để khắc phục điểm yếu này, tôi đã viết một bộ trang hoàng (decorator) nhỏ để bắt lỗi ngay khi một lớp cụ thể được định nghĩa thiếu. Định nghĩa thiếu ở đây mang ý nghĩa rằng lớp cụ thể đã quên định nghĩa một phương thức nào đó.</p>
<div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;Set of (class) decorators to help with interface programming.</span>

<span class="sd">Examples::</span>

<span class="sd">  @concrete</span>
<span class="sd">  class subclass(parent):</span>
<span class="sd">      ...</span>

<span class="sd">Released to the public domain.</span>

<span class="sd">Nam T. Nguyen, 2012</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">dis</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">unittest</span>


<span class="k">def</span> <span class="nf">concrete</span><span class="p">(</span><span class="n">orig_class</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A decorator to ensure that a concrete class has no un-implemented</span>
<span class="sd">    methods.</span>

<span class="sd">    An un-implemented method is defined similarly to::</span>

<span class="sd">        def method(...):</span>
<span class="sd">            raise NotImplementedError()</span>

<span class="sd">    This, when translated to bytecode, looks like::</span>

<span class="sd">        LOAD_GLOBAL       0 (NotImplementedError)</span>
<span class="sd">        CALL_FUNCTION     1</span>
<span class="sd">        RAISE_VARARGS     1</span>
<span class="sd">        ...</span>

<span class="sd">    Or when ``raise NotImplementedError``::</span>

<span class="sd">        LOAD_GLOBAL       0 (NotImplementedError)</span>
<span class="sd">        RAISE_VARARGS     1</span>
<span class="sd">        ...</span>

<span class="sd">    The check here is for such pattern.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">orig_class</span><span class="p">):</span>
        <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">orig_class</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="c1"># correct type?</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="c1"># check if first name is NotImplementedError</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">func_code</span><span class="o">.</span><span class="n">co_names</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> \
                <span class="n">func</span><span class="o">.</span><span class="n">func_code</span><span class="o">.</span><span class="n">co_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;NotImplementedError&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># and RAISE_VARARGS somewhere after that</span>
        <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">func_code</span><span class="o">.</span><span class="n">co_code</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">position</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">opcode</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">func_code</span><span class="o">.</span><span class="n">co_code</span><span class="p">[</span><span class="n">position</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">dis</span><span class="o">.</span><span class="n">opname</span><span class="p">[</span><span class="n">opcode</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RAISE_VARARGS&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;Function </span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1"> must be implemented.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">orig_class</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">func_name</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">orig_class</span>


<span class="k">class</span> <span class="nc">ConcreteTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">test1</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="n">concrete</span><span class="p">,</span> <span class="n">test1</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">test2</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="n">concrete</span><span class="p">,</span> <span class="n">test2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_not_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">test</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="n">concrete</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_subclass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">parent</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">override_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="k">class</span> <span class="nc">test</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">leave_it</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="n">concrete</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
<p>Để sử dụng bộ trang hoàng <strong>concrete</strong> này, ta sẽ sửa lại lớp <strong>ConcreteClass</strong> như sau:</p>
<div class="highlight"><pre><span></span><span class="nd">@concrete</span>
<span class="k">class</span> <span class="nc">ConcreteClass</span><span class="p">(</span><span class="n">AbstractClass</span><span class="p">):</span>
    <span class="c1"># như trên</span>
</pre></div>
<p>Nếu <strong>ConcreteClass</strong> quên hiện thực hóa một phương thức nào đó, Python sẽ thông báo <strong>SyntaxError</strong> ngay sau khi <strong>ConcreteClass</strong> được định nghĩa.</p>
</div>
<div class="section" id="tom-tat">
<h2>Tóm tắt</h2>
<p>Lập trình giao diện giúp chúng ta tách biệt hai yếu tố là cái gì, và như thế nào. Người sử dụng quan tâm nhiều đến câu hỏi <strong>cái gì</strong> được thực hiện hơn là làm sao để thực hiện chúng. Trong khi người cung cấp có thể dễ dàng thay đổi <strong>cách thực hiện</strong> miễn sao vẫn đảm bảo câu chữ của hợp đồng.</p>
<p>Python không có sẵn cơ chế giao diện và lớp trừu tượng như các ngôn ngữ lập trình khác. Chúng ta phải sử dụng bộ trang hoàng <strong>concrete</strong> để bắt lỗi định nghĩa thiếu.</p>
<p>Hy vọng bài viết ngắn này sẽ đem lại cho bạn đọc một mẹo lập trình giao diện hữu ích trong Python.</p>
</div>

  </div>



        </div>

          <div class="col-md-3">
  <div class="well">

    <p><abbr title="2012-07-18T06:06:00+07:00"><i class="fa fa-calendar"></i> Wed 18 July 2012</abbr></p>

      <p><address>
        <i class="fa fa-user"></i> By
          <a href="../../author/nguyen-thanh-nam.html" rel="author">Nguyễn Thành Nam</a>
      </address></p>

    <hr/>

      <p>
              <a href="../../category/bai-viet.html" rel="tag"
                  data-toggle="tooltip" class="label label-info"
                  title="44 articles in this category">Bài viết</a>
            <a href="../../tag/design.html" data-toggle="tooltip"
      class="label label-default"
      title="1 article with this tag">design</a>
            <a href="../../tag/interface.html" data-toggle="tooltip"
      class="label label-default"
      title="1 article with this tag">interface</a>
            <a href="../../tag/abstract.html" data-toggle="tooltip"
      class="label label-default"
      title="1 article with this tag">abstract</a>
            <a href="../../tag/concrete.html" data-toggle="tooltip"
      class="label label-default"
      title="1 article with this tag">concrete</a>
      </p>
      <hr/>



  </div>
            
          </div>

      </div>

    </div>

    <!-- TODO: make footer sticky -->
    <footer class="container-fluid">
      <div class="container">
        <div class="row">

            <div class="col-md-2">
            </div>
            <div class="col-md-2">
                <h5>Links</h5>
                <ul class="list-unstyled">
                  <li>  <a href="https://www.python.org/">
      <i class="fa fa-link fa-fw"></i>
    Python.org
  </a></li>
                </ul>
            </div>

          <div class="col-md-2">
            <h5>Browse content by</h5>
            <ul class="list-unstyled">
                <li><a href="../../authors.html"><i class="fa fa-user fa-fw"></i> Authors</a></li>
                <li><a href="../../categories.html"><i class="fa fa-folder fa-fw"></i> Categories</a></li>
                <li><a href="../../archives.html"><i class="fa fa-calendar fa-fw"></i> Dates</a></li>
                <li><a href="../../tags.html"><i class="fa fa-tag fa-fw"></i> Tags</a></li>
            </ul>
          </div>

          <div class="col-md-2">
              <h5>Feeds</h5>
              <ul class="list-unstyled">
                  <li><small><a href="/feeds/all.atom.xml"><i class="fa fa-rss fa-fw"></i> All posts (Atom)</a></small></li>
                  <li><small><a href="/feeds/bai-viet.atom.xml"><i class="fa fa-rss fa-fw"></i> Category: Bài viết (Atom)</a></small></li>
              </ul>
          </div>

        </div>
      </div>

      <h5 class="text-right"><a href="#"><i class="fa fa-arrow-up"></i> Back to top</a></h5>

      <div class="container">
        <div class="row col-md-12 text-muted text-center">
          <p>&copy; 2007-2016 Nhóm PCNV.</p>
          Site generated by <a href="https://getpelican.com"> Pelican</a>.<br/>
          <a href="https://github.com/kdeldycke/plumage"> Plumage</a> theme by <a href="https://kevin.deldycke.com">Kevin Deldycke</a>.
        </div>
      </div>

    </footer>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"></script>
    <script src="../../theme/js/jquery.mglass.js"></script>
    <script src="../../theme/js/application.js"></script>

  </body>
</html>